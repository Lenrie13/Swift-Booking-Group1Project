{"ast":null,"code":"import React,{useState,useEffect,useMemo}from'react';import BookingForm from'./BookingForm';import\"./BookingPage.css\";import{useNavigate,useLocation}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const BookingPage=_ref=>{var _selectedHotel$name;let{setBookingData}=_ref;const[rooms,setRooms]=useState([]);const[roomPrices,setRoomPrices]=useState({});const[selectedHotel,setSelectedHotel]=useState();const[hotels,setHotels]=useState([]);const[deals,setDeals]=useState([]);const[amountPayable,setAmountPayable]=useState(0);const[hotelDeals,setHotelDeals]=useState([]);const navigate=useNavigate();const location=useLocation();const{arrivalDate,departureDate,numberOfNights,guests}=location.state||{};const onSelectHotel=e=>{const hotel=hotels.find(hotel=>hotel.id===e.target.value);setSelectedHotel(hotel);};useEffect(()=>{fetch('http://localhost:3000/hotels').then(response=>response.json()).then(data=>setHotels(data)).catch(error=>console.error('Error fetching hotels:',error));},[]);useEffect(()=>{fetch('http://localhost:3000/deals').then(response=>response.json()).then(data=>setDeals(data)).catch(error=>console.error('Error fetching deals:',error));},[]);useEffect(()=>{if(selectedHotel){fetch(`http://localhost:3000/hotels/${selectedHotel.id}`).then(response=>response.json()).then(data=>{setRooms(data.rooms);const prices=data.rooms.reduce((acc,room)=>{acc[room.type]=room.pricePerNight;return acc;},{});setRoomPrices(prices);const applicableDeals=deals.filter(deal=>deal.hotelId===selectedHotel.id);setHotelDeals(applicableDeals);}).catch(error=>console.error('Error fetching hotel data:',error));}},[selectedHotel,deals]);const handleBookingSubmit=data=>{setBookingData(data);navigate('/payment',{state:{...data}});};const calculateAmountPayable=(roomType,guests)=>{const pricePerNight=roomPrices[roomType]||0;let totalAmount=pricePerNight*numberOfNights*guests;const applicableDeals=hotelDeals.filter(deal=>{const dealStartDate=new Date(deal.startDate);const dealEndDate=new Date(deal.endDate);const selectedArrivalDate=new Date(arrivalDate);const selectedDepartureDate=new Date(departureDate);return selectedArrivalDate>=dealStartDate&&selectedDepartureDate<=dealEndDate;});if(applicableDeals.length>0){totalAmount*=1-applicableDeals[0].discount/100;}return totalAmount;};return/*#__PURE__*/_jsxs(\"div\",{className:\"booking-page-form\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Booking Form\"}),\" \",/*#__PURE__*/_jsx(\"h2\",{children:\"Select a Hotel\"}),/*#__PURE__*/_jsxs(\"select\",{onChange:onSelectHotel,value:(_selectedHotel$name=selectedHotel===null||selectedHotel===void 0?void 0:selectedHotel.name)!==null&&_selectedHotel$name!==void 0?_selectedHotel$name:'',children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"Select a hotel\"}),hotels.map(hotel=>/*#__PURE__*/_jsx(\"option\",{value:hotel.id,children:hotel.name},hotel.id))]}),selectedHotel&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(BookingForm,{onSubmit:handleBookingSubmit,rooms:rooms,calculateAmountPayable:calculateAmountPayable,amountPayable:amountPayable,setAmountPayable:setAmountPayable,initialArrivalDate:arrivalDate,initialDepartureDate:departureDate,numberOfGuests:guests,numberOfNights:numberOfNights,selectedHotel:selectedHotel,deals:deals})})]});};export default BookingPage;","map":{"version":3,"names":["React","useState","useEffect","useMemo","BookingForm","useNavigate","useLocation","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","BookingPage","_ref","_selectedHotel$name","setBookingData","rooms","setRooms","roomPrices","setRoomPrices","selectedHotel","setSelectedHotel","hotels","setHotels","deals","setDeals","amountPayable","setAmountPayable","hotelDeals","setHotelDeals","navigate","location","arrivalDate","departureDate","numberOfNights","guests","state","onSelectHotel","e","hotel","find","id","target","value","fetch","then","response","json","data","catch","error","console","prices","reduce","acc","room","type","pricePerNight","applicableDeals","filter","deal","hotelId","handleBookingSubmit","calculateAmountPayable","roomType","totalAmount","dealStartDate","Date","startDate","dealEndDate","endDate","selectedArrivalDate","selectedDepartureDate","length","discount","className","children","onChange","name","disabled","map","onSubmit","initialArrivalDate","initialDepartureDate","numberOfGuests"],"sources":["/Users/lenrieogutu/Projects/moringaSchool/phaseFourContent/Swift-Booking-Group1Project/src/Components/BookingPage.js"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\nimport BookingForm from './BookingForm';\nimport \"./BookingPage.css\"\nimport { useNavigate, useLocation } from 'react-router-dom';\n\nconst BookingPage = ({ setBookingData }) => {\n    const [rooms, setRooms] = useState([]);\n    const [roomPrices, setRoomPrices] = useState({});\n    const [selectedHotel, setSelectedHotel] = useState();\n    const [hotels, setHotels] = useState([]);\n    const [deals, setDeals] = useState([]);\n    const [amountPayable, setAmountPayable] = useState(0);\n    const [hotelDeals, setHotelDeals] = useState([]);\n    const navigate = useNavigate();\n    const location = useLocation();\n\n    const { arrivalDate, departureDate, numberOfNights, guests } = location.state || {};\n\n    const onSelectHotel=(e)=>{\n        const hotel = hotels.find((hotel)=>hotel.id === e.target.value);\n        setSelectedHotel(hotel);\n    }\n\n    useEffect(() => {\n        fetch('http://localhost:3000/hotels')\n            .then(response => response.json())\n            .then(data => setHotels(data))\n            .catch(error => console.error('Error fetching hotels:', error));\n    }, []);\n\n    useEffect(() => {\n        fetch('http://localhost:3000/deals')\n            .then(response => response.json())\n            .then(data => setDeals(data))\n            .catch(error => console.error('Error fetching deals:', error));\n    }, []);\n\n    useEffect(() => {\n        if (selectedHotel) {\n            fetch(`http://localhost:3000/hotels/${selectedHotel.id}`)\n                .then(response => response.json())\n                .then(data => {\n                    setRooms(data.rooms);\n                    const prices = data.rooms.reduce((acc, room) => {\n                        acc[room.type] = room.pricePerNight;\n                        return acc;\n                    }, {});\n                    setRoomPrices(prices);\n\n                    const applicableDeals = deals.filter(deal => deal.hotelId === selectedHotel.id);\n                    setHotelDeals(applicableDeals);\n                })\n                .catch(error => console.error('Error fetching hotel data:', error));\n        }\n    }, [selectedHotel, deals]);\n\n    const handleBookingSubmit = (data) => {\n        setBookingData(data);\n        navigate('/payment',{state:{...data}});\n    };\n\n    const calculateAmountPayable = (roomType, guests) => {\n        const pricePerNight = roomPrices[roomType] || 0;\n        let totalAmount = pricePerNight * numberOfNights * guests;\n    \n        const applicableDeals = hotelDeals.filter(deal => {\n            const dealStartDate = new Date(deal.startDate);\n            const dealEndDate = new Date(deal.endDate);\n            const selectedArrivalDate = new Date(arrivalDate);\n            const selectedDepartureDate = new Date(departureDate);\n            return selectedArrivalDate >= dealStartDate && selectedDepartureDate <= dealEndDate;\n        });\n    \n        if (applicableDeals.length > 0) {\n            totalAmount *= (1 - applicableDeals[0].discount / 100);\n        }\n    \n        return totalAmount;\n    };\n    return (\n        <div className='booking-page-form'>\n            <h1>Booking Form</h1> {/* Moved title to the top */}\n            \n            <h2>Select a Hotel</h2>\n            <select onChange={onSelectHotel} value={selectedHotel?.name??''}>\n                <option value=\"\" disabled>Select a hotel</option>\n                {hotels.map(hotel => (\n                    <option key={hotel.id} value={hotel.id}>\n                        {hotel.name}\n                    </option>\n                ))}\n            </select>\n\n            {selectedHotel && (\n                <>\n                    <BookingForm \n                        onSubmit={handleBookingSubmit}\n                        rooms={rooms}\n                        calculateAmountPayable={calculateAmountPayable}\n                        amountPayable={amountPayable}\n                        setAmountPayable={setAmountPayable}\n                        initialArrivalDate={arrivalDate}\n                        initialDepartureDate={departureDate}\n                        numberOfGuests={guests}\n                        numberOfNights={numberOfNights}\n                        selectedHotel={selectedHotel}\n                        deals={deals}\n                    />\n                </>\n            )}\n        </div>\n    );\n};\n\nexport default BookingPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}